<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á - {{ grade }} –∫–ª–∞—Å—Å</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
</head>
<body>
    <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∫–ª–∞—Å—Å–∞ –≤ JS -->
    <input type="hidden" id="currentGrade" value="{{ grade }}">

    <nav>
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/solve?grade={{ grade }}">–ë–∏–ª–µ—Ç—ã ({{ grade }} –∫–ª–∞—Å—Å)</a>
        <button id="openMaterialsBtn" class="nav-btn">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ (F1)</button>
    </nav>

    {% if task %}
    <div class="workspace">
        <div class="task-description">
            <!-- safe –Ω—É–∂–µ–Ω, –µ—Å–ª–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ —Ç–æ–∂–µ –µ—Å—Ç—å HTML (–Ω–∞–ø—Ä–∏–º–µ—Ä <b>–î–∞–Ω–æ</b>) -->
            <h2>{{ task.title }}</h2>
            <div style="font-size: 1.1em; line-height: 1.6;">
                {{ task.description | safe }}
            </div>
        </div>
        <div class="editor-container">
            <div id="editor">{{ task.initial_code }}</div>
        </div>
        <!-- –ù–∏–∑: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –∫–æ–Ω—Å–æ–ª—å -->
        <div class="controls">
            <button onclick="runCode()" class="btn run">–ó–∞–ø—É—Å—Ç–∏—Ç—å (Ctrl+Enter)</button>
            <button onclick="checkSolution({{ task.id }})" class="btn check">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <button onclick="resetCode()" class="btn secondary" title="–í–µ—Ä–Ω—É—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥">–°–±—Ä–æ—Å</button>
            
            <!-- –ö–ù–û–ü–ö–ê –ü–û–î–°–ö–ê–ó–ö–ò -->
            {% if task.explanation %}
            <button onclick="showExplanation()" class="btn hint" title="–•–æ–¥ —Ä–µ—à–µ–Ω–∏—è">üí° –•–æ–¥ —Ä–µ—à–µ–Ω–∏—è</button>
            {% endif %}

            {% if next_id %}
            <a href="/solve?grade={{ grade }}&id={{ next_id }}" id="nextTaskBtn" class="btn next" style="display:none;">–í–ø–µ—Ä–µ–¥ &rarr;</a>
            {% endif %}
        </div>
    <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ (–¥–ª—è –∫–Ω–æ–ø–∫–∏ –°–±—Ä–æ—Å) -->
    <textarea id="initialCodeStore" style="display:none;">{{ task.initial_code }}</textarea>
        <div class="console">
            <h3>–í—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã:</h3>
            <pre id="outputBlock">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞...</pre>
        </div>
    </div>

    {% else %}
    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á GRID -->
    <div class="container">
        <h2>–ë–∏–ª–µ—Ç—ã: {{ grade }} –∫–ª–∞—Å—Å</h2>
        
        <div class="reset-container">
            <button onclick="resetAllProgress()" class="btn danger">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–ª–∞—Å—Å–∞</button>
        </div>

        <div class="task-grid">
            {% for t in tasks_list %}
            <a href="/solve?grade={{ grade }}&id={{ t.id }}" class="task-card" data-id="{{ t.id }}">
                <h3>{{ t.title }}</h3>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –° –¢–ê–ë–ê–ú–ò -->
    <div id="materialsModal" class="modal">
        <div class="modal-content large">
            <span class="close">&times;</span>
            <h2>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫</h2>
            <div class="modal-body">
                <div class="modal-sidebar">
                    {% for key in materials.keys() %}
                    <div class="modal-tab" onclick="openModalTab('{{ loop.index0 }}')">{{ key }}</div>
                    {% endfor %}
                </div>
                <div class="modal-text">
                    {% for key, val in materials.items() %}
                    <div id="modal-tab-{{ loop.index0 }}" class="modal-tab-content" style="display:none;">
                        <h3>{{ key }}</h3>
                        {{ val|safe }}
                    </div>
                    {% endfor %}
                    <div id="modal-welcome">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É —Å–ª–µ–≤–∞</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–î–ï–°–¨: –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä | safe -->
    {% if task %}
    <div id="explanationStore" style="display:none;">{{ task.explanation | safe }}</div>
    {% endif %}

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–•–æ–¥ —Ä–µ—à–µ–Ω–∏—è" -->
    <div id="explanationModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeExplanation()">&times;</span>
            <h2 style="color: #ffc107;">üí° –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–µ—à–µ–Ω–∏—è</h2>
            <div id="explanationText" class="text-block">
                <!-- –°—é–¥–∞ JS –≤—Å—Ç–∞–≤–∏—Ç —Ç–µ–∫—Å—Ç -->
            </div>
            <p style="margin-top: 20px; color: #888; font-size: 0.9em;">
                *–ö–æ–¥ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é, —á—Ç–æ–±—ã –≤—ã –º–æ–≥–ª–∏ –ø–æ–¥—É–º–∞—Ç—å.
            </p>
        </div>
    </div>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>